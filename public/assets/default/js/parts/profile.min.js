$(function(e){"use strict";e(".inline-reservation-calender").pDatepicker({inline:!0,altField:"#inlineCalender",initialValue:!0,calendarType:"gregorian",initialValueType:!0,autoClose:!0,altFormat:"DD MMMM YY",calendar:{gregorian:{locale:"en"}},toolbox:{calendarSwitch:{enabled:!1}},navigator:{scroll:{enabled:!1},text:{btnNextText:"<",btnPrevText:">"}},minDate:(new persianDate).subtract("day",0).valueOf(),checkDate:function(e){return function(e){var a=new persianDate(e).day(),n=(new persianDate(e).startOf("day").unix(),new persianDate(e).endOf("day").unix(),!1);for(var t in availableDays)Number(availableDays[t])===a&&(n=!0);return n}(e)},timePicker:{enabled:!1},onSelect:function(a){var n=new persianDate(a),t=n.startOf("day").unix(),i=n.format("dddd"),s=n.format("YYYY-MM-DD");e("#selectedDay").val(s),function(a,n,t){var i=e("#PickTimeContainer"),s=e("#PickTimeBody"),r=e("#availableTimes"),o=i.find(".loading-img"),d=i.attr("data-user-id");i.removeClass("d-none"),e("html, body").animate({scrollTop:i.offset().top-window.innerHeight/2},600),s.addClass("d-none"),o.removeClass("d-none"),s.find(".selected_date span").text(e("#inlineCalender").val());var l={timestamp:a,day_label:n,date:t};e.post("/users/"+d+"/availableTimes",l,function(e){var a="";e&&void 0!==e.times&&(Object.keys(e.times).forEach(function(n){var t=e.times[n];a+='<div class="position-relative available-times '+(t.can_reserve?"":"disabled")+'">\n<input type="radio" name="time" id="availableTime'+t.id+'" value="'+t.id+'" '+(t.can_reserve?"":"disabled")+' data-type="'+t.meeting_type+'">\n<label for="availableTime'+t.id+'">'+t.time+"</label>\n",t.can_reserve||(a+='<span class="font-12 badge badge-danger text-white reserved-item">'+reservedLang+"</span>"),a+='<input type="hidden" class="js-time-description" value="'+t.description+'"/>',a+="</div>"}),r.html(a))}).always(function(){s.removeClass("d-none"),o.addClass("d-none")})}(t,i,s)}}),e("body").on("change",'input[name="time"]',function(a){if(this.checked){var n=e("#PickTimeBody"),t=e(this),i=t.attr("data-type"),s=t.parent().find("label").text(),r=n.find(".selected_date span").text();n.find(".selected-date-time span").text(r+" | "+s),e(".js-finalize-reserve").removeClass("d-none");var o=e('input[value="online"]').closest(".meeting-type-reserve"),d=e('input[value="in_person"]').closest(".meeting-type-reserve");o.removeClass("disabled"),o.find("input").prop("disabled",!1),d.removeClass("disabled"),d.find("input").prop("disabled",!1),"in_person"===i&&(o.addClass("disabled"),o.find("input").prop("disabled",!0)),"online"===i&&(d.addClass("disabled"),d.find("input").prop("disabled",!0));var l=t.parent().find(".js-time-description"),c=e(".js-time-description-card");l&&l.val()&&"null"!==l.val()&&"undefined"!==l.val()?(c.removeClass("d-none"),c.text(l.val())):c.addClass("d-none")}}),e("body").on("change",'input[name="meeting_type"]',function(a){if(e("#withGroupMeetingSwitch").prop("checked",!1),e(".js-group-meeting-options").addClass("d-none"),e('input[name="student_count"]').val(1),e(".wrunner").remove(),this.checked){var n=e(this).val(),t=e(".js-group-meeting-switch"),i=e(".js-online-group-amount"),s=e(".js-in-person-group-amount");t.removeClass("d-none").addClass("d-flex"),"in_person"===n&&(i.addClass("d-none"),s.removeClass("d-none")),"online"===n&&(i.removeClass("d-none"),s.addClass("d-none")),e(".js-reserve-btn").removeClass("d-none").addClass("d-flex"),e(".js-reserve-description").removeClass("d-none")}}),e("body").on("change","#withGroupMeetingSwitch",function(a){var n=e(".js-group-meeting-options");e('input[name="student_count"]').val(1),e(".wrunner").remove(),this.checked?(n.removeClass("d-none"),function(){var a=e("#studentCountRange");if(a&&jQuery().wRunner){var n=e('input[name="meeting_type"]:checked').val();if(n){var t=a.attr("data-minLimit"),i="in_person"===n?e("#in_person_group_max_student").val():e("#online_group_max_student").val(),s=a.find('input[name="student_count"]'),r=a.wRunner({type:"single",limits:{minLimit:t,maxLimit:i},singleValue:t,step:1});r.onValueUpdate(function(e){s.val(e.value)})}}}()):n.addClass("d-none")}),e("body").on("click",".js-submit-form",function(a){a.preventDefault();var n=e(this);n.addClass("loadingbar primary").prop("disabled",!0);var t=n.closest("form"),i=(t.attr("action"),t.serializeObject());e.post("/meetings/reserve",i,function(a){e.toast({heading:a.title,text:a.msg,bgColor:"success"===a.status?"#43d477":"#f63c3c",textColor:"white",hideAfter:1e4,position:"bottom-right",icon:a.status}),"success"===a.status&&void 0!==a.redirect?window.location.href=a.redirect:n.removeClass("loadingbar gray").prop("disabled",!1)}).fail(function(e){n.removeClass("loadingbar gray").prop("disabled",!1)})}),e("body").on("click","#followToggle",function(a){a.preventDefault();var n=e(this);n.addClass("loadingbar primary").prop("disabled",!0);var t="/users/"+n.attr("data-user-id")+"/follow";e.get(t,function(e){n.removeClass("loadingbar primary").prop("disabled",!1),e&&200===e.code&&(e.follow?(n.removeClass("btn-primary").addClass("btn-danger"),n.text(unFollowLang)):(n.removeClass("btn-danger").addClass("btn-primary"),n.text(followLang)))})}),e("body").on("click",".js-refresh-captcha",function(e){e.preventDefault(),refreshCaptcha()}),e("body").on("click",".js-send-message",function(a){a.preventDefault(),Swal.fire({html:e("#sendMessageModal").html(),showCancelButton:!1,showConfirmButton:!1,customClass:{content:"p-0 text-left"},onOpen:function(){refreshCaptcha()},width:"42rem"})}),e("body").on("click",".js-send-message-submit",function(a){a.preventDefault();var n=e(this);n.addClass("loadingbar primary").prop("disabled",!0);var t=n.closest("form"),i=t.attr("action"),s=t.serializeObject();e.post(i,s,function(e){e&&200===e.code?(Swal.fire({icon:"success",html:'<h3 class="font-20 text-center text-dark-blue">'+messageSuccessSentLang+"</h3>",showConfirmButton:!1}),setTimeout(function(){window.location.reload()},2e3)):Swal.fire({icon:"error",html:'<h3 class="font-20 text-center text-dark-blue">'+e.message+"</h3>",showConfirmButton:!1})}).fail(function(e){n.removeClass("loadingbar primary").prop("disabled",!1);var a=e.responseJSON;refreshCaptcha(),a&&a.errors&&Object.keys(a.errors).forEach(function(e){var n=a.errors[e],i=t.find('[name="'+e+'"]');i.addClass("is-invalid"),i.parent().find(".invalid-feedback").text(n[0])})})})});
